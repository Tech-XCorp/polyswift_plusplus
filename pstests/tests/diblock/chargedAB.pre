######################################################################
#
# File:         chargedAB.pre
#
# Purpose:      Test for linear 2 component diblock w/ charged block model
#
# Define variables in lines starting with '$' for later use
######################################################################

#############################################
# Reduced temperature expressions
# from R. Kumar paper

$ NLEN = 1000
$ ALPHA = 0.01
$ REDUCEDT = 1.4

$ CHIVAL = 1.0 / (20.0*3.1415*REDUCEDT)
$ BLEN  = 1.0 / (4.0*3.1415*ALPHA*REDUCEDT)
#############################################

########################################
# Special parameter definitions to be
# shared by several objects

$ FA = 0.50
$ ZA = 1.0

# With scaled lB
$ NFAC = ZA*ALPHA*FA
########################################

###################################
#  Grid parameters                #
#    Num-cells in sim  [NX NY NZ] #
#    Cell length in Rg [DX DY DZ] #
###################################
$ NX = 128
$ NY = 128
$ NZ = 1
$ DX = 0.05
$ DY = 0.05
$ DZ = 0.05
$ DS = 0.05

############################
#   Debug print flags      #
############################
$ DBSTATUS0     = "'off'"
$ DBUPDATER     = "'off'"
$ DBINTERACTION = "'off'"
$ DBEFFHAMIL    = "'off'"
$ DBPOLYMER     = "'off'"
$ DBBLOCK       = "'off'"
$ DBPHYSFIELD   = "'off'"

##########################################################
#            Domain parameters and defaults              #
##########################################################

nsteps = 400            # timesteps in relaxation algo.
dumpPeriodicity = 100   # dump period
randomSeed = 38383      # If not set, seed uses default
printdebug = off        # Switch for certain debug msgs

$ import pseudoSpecSetup
setupPS(NX, NY, NZ, DX, DY, DZ, "'off'")
##########################################################

#########################################################
# Effective Hamiltonian: defines energetic SCFT model
#   (for now) the update methods
#########################################################
<EffHamil mainHamil>

  kind = canonicalMF
  printdebug = 'off'

  updaterSequence = [wAwB ePotential]

  <Updater ePotential>

    kind = poissonUpdater
    fftKind = fftWObj
    printdebug = 'off'
    applyFrequency = 5
    shiftDensFlag = false
    relaxlambda = 1.0

    # For now... Bjerrum length with constant
    dielectric is defined here in updater
    bjerrumLen = BLEN

    # Two-component updates
    updatefields = [ totChargeDens ]

  </Updater>

  <Updater wAwB>
    kind = steepestDescent
    type = incompressible

    relaxlambdas = [0.20 0.10]
    shiftDensFlag = false
    noise = 0.002
    printdebug = DBUPDATER

    # Two-component updates
    updatefields = [totStyrDens totEthyDens]
    interactions = [StyrEthy]

  </Updater>

  # Interactions can be separate from Any Updater/etc
  # blocks or type of eff-Hamiltonian
  <Interaction StyrEthy>
     kind = flory
     chi = CHIVAL
     shiftDensFlag = false
     scfields = [totStyrDens totEthyDens]
     printdebug = DBINTERACTION
  </Interaction>

</EffHamil>

#######################################################
# Physical "observable" fields
#######################################################

<PhysField totStyrDens>
   kind = monomerDens
   type = fieldD3R
   printdebug = DBPHYSFIELD
</PhysField>

<PhysField totEthyDens>
   kind = monomerDens
   type = fieldD3R
   printdebug = DBPHYSFIELD
</PhysField>

<PhysField totChargeDens>
   kind = chargeDens
   type = fieldD3R
   printdebug = DBPHYSFIELD
</PhysField>

<PhysField counterIonDens>
   kind = chargeDens
   type = fieldD3R
   printdebug = DBPHYSFIELD
</PhysField>

<PhysField defaultPressure>
   kind = constraint
   type = fieldD3R
   printdebug = PHYSFIELDDB
</PhysField>

#################################################################
#  A Polymer primarily describes chain architecture...namely
#  a collection of <Block>s (eg homopolymer, diblock, triblock,
#  n-arm star, n-arm branched etc).
#
#  The length of the "first" polymer listed will be used to
#  to scale the theory
#################################################################

<Solvent counterIons>

  kind = simpleIons
  printdebug = 'off'

  volfrac = 0.0
  zc = -1.0
  neutralFactor = NFAC

  scfield = totStyrDens
  chargefield = totChargeDens
  blockfield = counterIonDens

</Solvent>

<Polymer diblock1>

  kind = blockCopolymer
  volfrac = 1.0
  length = NLEN
  printdebug = DBPOLYMER

  <Block blockA>
    kind = chargeFlexPseudoSpec
    scfield = totStyrDens
    chargefield = totChargeDens
    za = ZA
    alpha = ALPHA

    ds = DS
    lengthfrac = FA
    headjoined = [freeEnd]
    tailjoined = [blockB]
    printdebug = DBBLOCK
  </Block>

  <Block blockB>
    kind = flexPseudoSpec
    scfield = totEthyDens
    ds = DS
    lengthfrac = 0.50
    headjoined = [blockA]
    tailjoined = [freeEnd]
    printdebug = DBBLOCK
  </Block>

</Polymer>
